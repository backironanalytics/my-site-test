---
title: "Dollar Data Science"
output: 
  flexdashboard::flex_dashboard:
    theme: simplex
    orientation: rows
    logo: logo_simple.png
    favicon: logo_simple.png


---

```{r setup, include=FALSE, echo = FALSE}


##Pts Reb Ast


ptrebast <- lapply(next_team_batch$idPlayer, function(x){
  
  hit_rate <- seq(10.5,60.5,1)
  
  df <- playerdata %>% filter(idPlayer == x, typeSeason == "Regular Season", slugSeason == "2024-25") %>% 
    mutate(pts_reb_ast = pts+treb+ast) %>% select(namePlayer,idPlayer,slugTeam,dateGame,locationGame,pts_reb_ast)
  
  hit_rate_above <- lapply(hit_rate, function(x){
    
    df %>% mutate(test = mean(pts_reb_ast > x), OU = x) %>% group_by(namePlayer, idPlayer, slugTeam, OU) %>% summarize(test = min(test), .groups = 'drop') %>% ungroup()
    
  })
  
  hit_rate_above
  
})

ptrebast <- bind_rows(ptrebast) %>% pivot_wider(names_from = OU, values_from = test)

ptrebast_pivoted <- ptrebast %>% left_join(playerdata %>% filter(typeSeason == "Regular Season", slugSeason == "2024-25") %>% group_by(idPlayer) %>% 
                                     summarize(GP = n()), by = "idPlayer")  %>% 
  left_join(teams, by = "slugTeam") %>% rename(Player = namePlayer, Team = slugTeam) %>% 
  mutate_if(is.numeric,funs(round(.*100,1)))  %>% select(!c(idPlayer,Team,Opponent,idTeam,nameTeam)) %>% 
  relocate(urlThumbnailTeam, .after = Player) %>% relocate(GP, .after = urlThumbnailTeam) %>% mutate(GP = GP/100) %>% mutate(Type = "Regular Season")


##Pts Reb Ast Home Games


ptrebast_home <- lapply(next_team_batch$idPlayer, function(x){
  
  hit_rate <- seq(10.5,60.5,1)
  
  df <- playerdata %>% filter(idPlayer == x, typeSeason == "Regular Season", slugSeason == "2024-25", locationGame == "H") %>% 
    mutate(pts_reb_ast = pts+treb+ast) %>% select(namePlayer,idPlayer,slugTeam,dateGame,locationGame,pts_reb_ast)
  
  hit_rate_above <- lapply(hit_rate, function(x){
    
    df %>% mutate(test = mean(pts_reb_ast > x), OU = x) %>% group_by(namePlayer, idPlayer, slugTeam, OU) %>% summarize(test = min(test), .groups = 'drop') %>% ungroup()
    
  })
  
  hit_rate_above
  
})

ptrebast_home <- bind_rows(ptrebast_home) %>% pivot_wider(names_from = OU, values_from = test)

ptrebast_pivoted_home <- ptrebast_home %>% left_join(playerdata %>% filter(typeSeason == "Regular Season", slugSeason == "2024-25", locationGame == "H") %>% group_by(idPlayer) %>% 
                                     summarize(GP = n()), by = "idPlayer")  %>% 
  left_join(teams, by = "slugTeam") %>% rename(Player = namePlayer, Team = slugTeam) %>% 
  mutate_if(is.numeric,funs(round(.*100,1)))  %>% select(!c(idPlayer,Team,Opponent,idTeam,nameTeam)) %>% 
  relocate(urlThumbnailTeam, .after = Player) %>% relocate(GP, .after = urlThumbnailTeam) %>% mutate(GP = GP/100) %>% mutate(Type = "Home Games")



##Pts Reb Ast Away Games


ptrebast_away <- lapply(next_team_batch$idPlayer, function(x){
  
  hit_rate <- seq(10.5,60.5,1)
  
  df <- playerdata %>% filter(idPlayer == x, typeSeason == "Regular Season", slugSeason == "2024-25", locationGame == "A") %>% 
    mutate(pts_reb_ast = pts+treb+ast) %>% select(namePlayer,idPlayer,slugTeam,dateGame,locationGame,pts_reb_ast)
  
  hit_rate_above <- lapply(hit_rate, function(x){
    
    df %>% mutate(test = mean(pts_reb_ast > x), OU = x) %>% group_by(namePlayer, idPlayer, slugTeam, OU) %>% summarize(test = min(test), .groups = 'drop') %>% ungroup()
    
  })
  
  hit_rate_above
  
})

ptrebast_away <- bind_rows(ptrebast_away) %>% pivot_wider(names_from = OU, values_from = test)

ptrebast_pivoted_away <- ptrebast_away %>% left_join(playerdata %>% filter(typeSeason == "Regular Season", slugSeason == "2024-25", locationGame == "A") %>% group_by(idPlayer) %>% 
                                     summarize(GP = n()), by = "idPlayer")  %>% 
  left_join(teams, by = "slugTeam") %>% rename(Player = namePlayer, Team = slugTeam) %>% 
  mutate_if(is.numeric,funs(round(.*100,1)))  %>% select(!c(idPlayer,Team,Opponent,idTeam,nameTeam)) %>% 
  relocate(urlThumbnailTeam, .after = Player) %>% relocate(GP, .after = urlThumbnailTeam) %>% mutate(GP = GP/100) %>% mutate(Type = "Away Games")


ptreb_ast_df <- bind_rows(ptrebast_pivoted,ptrebast_pivoted_away,ptrebast_pivoted_home) %>% relocate(Type, .after = GP)


##Pts


pt <- lapply(next_team_batch$idPlayer, function(x){
  
  hit_rate <- seq(3.5,40.5,1)
  
  df <- playerdata %>% filter(idPlayer == x, typeSeason == "Regular Season", slugSeason == "2024-25") %>% 
    mutate(pts_reb_ast = pts+treb+ast) %>% select(namePlayer,idPlayer,slugTeam,dateGame,locationGame,pts)
  
  hit_rate_above <- lapply(hit_rate, function(x){
    
    df %>% mutate(test = mean(pts > x), OU = x) %>% group_by(namePlayer, idPlayer, slugTeam, OU) %>% summarize(test = min(test), .groups = 'drop') %>% ungroup()
    
  })
  
  hit_rate_above
  
})

pt <- bind_rows(pt) %>% pivot_wider(names_from = OU, values_from = test)

pt_pivoted <- pt %>% left_join(playerdata %>% filter(typeSeason == "Regular Season", slugSeason == "2024-25") %>% group_by(idPlayer) %>% 
                                     summarize(GP = n()), by = "idPlayer")  %>% 
  left_join(teams, by = "slugTeam") %>% rename(Player = namePlayer, Team = slugTeam) %>% 
  mutate_if(is.numeric,funs(round(.*100,1)))  %>% select(!c(idPlayer,Team,Opponent,idTeam,nameTeam)) %>% 
  relocate(urlThumbnailTeam, .after = Player) %>% relocate(GP, .after = urlThumbnailTeam) %>% mutate(GP = GP/100)




```

Matrix
=======================================================================


Row  {.tabset .tabset-fade .tabset-pills}
-----------------------------------------------------------------------

### Pts + Reb + Ast


```{r output, echo = FALSE, warning = FALSE, message = FALSE}
reactable(highlight = TRUE, striped = TRUE,ptreb_ast_df, groupBy = "Player", columns = list(Player = colDef(sticky = "left", width = 110),
                                                                        urlThumbnailTeam = colDef(name = "Team",cell = embed_img(height = "25",width="40")),
                                                                        GP = colDef(aggregate = "max"),
                                                                        Type = colDef(aggregate = "max"),
                                                                        `10.5` = colDef(format = colFormat(suffix = "%"), aggreate = JS("function(values, rows){
                                                                        return 3
                                                                        }")),
                                                                        `11.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `12.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `13.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `14.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `15.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `16.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `17.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `18.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `19.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `20.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `21.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `22.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `23.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `24.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `25.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `26.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `27.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `28.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `29.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `30.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `31.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `32.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `33.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `34.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `35.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `36.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `37.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `38.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `39.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `40.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `41.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `42.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `43.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `44.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `45.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `46.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `47.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `48.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `49.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `50.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `51.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `52.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `53.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `54.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `55.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `56.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `57.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `58.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `59.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `60.5` = colDef(format = colFormat(suffix = "%"))), 
           theme = fivethirtyeight(), defaultPageSize = 20, searchable = TRUE, language = reactableLang(searchPlaceholder = "SEARCH FOR A PLAYER"), fullWidth = TRUE) 
```


### Pts


```{r pts, echo = FALSE, warning = FALSE, message = FALSE}
reactable(highlight = TRUE, striped = TRUE,pt_pivoted, columns = list(Player = colDef(sticky = "left", width = 110),
                                                                        urlThumbnailTeam = colDef(name = "Team",cell = embed_img(height = "25",width="40")),
                                                                        `3.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `4.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `5.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `6.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `7.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `8.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `9.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `10.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `11.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `12.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `13.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `14.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `15.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `16.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `17.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `18.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `19.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `20.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `21.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `22.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `23.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `24.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `25.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `26.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `27.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `28.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `29.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `30.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `31.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `32.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `33.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `34.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `35.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `36.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `37.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `38.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `39.5` = colDef(format = colFormat(suffix = "%")),
                                                                        `40.5` = colDef(format = colFormat(suffix = "%"))), 
           theme = fivethirtyeight(), defaultPageSize = 20, searchable = TRUE, language = reactableLang(searchPlaceholder = "SEARCH FOR A PLAYER"), fullWidth = TRUE) 

